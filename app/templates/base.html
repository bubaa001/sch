<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Francis Maria Libermann School - Holistic Education in Zanzibar. Education Key to Liberty.">
    <meta name="keywords" content="Libermann students, Secondary School, Education, Zanzibar">
    <meta name="author" content="Francis Maria Libermann School">
    <title>{% block title %}FML School{% endblock %}</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;600&family=Poppins:wght@300;500&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='assets/logo.jpeg') }}" type="image/jpeg">
</head>
<body>
    <!-- Preloader -->
    <div class="preloader" id="preloader">
        <div class="preloader-inner">
            <div class="preloader-animation">
                <svg viewBox="0 0 100 100" class="snip-loader">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="#1a73e8" stroke-width="8" stroke-dasharray="180 70" stroke-linecap="round">
                        <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="1.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="50" cy="50" r="30" fill="none" stroke="#34d399" stroke-width="6" stroke-dasharray="100 50" stroke-linecap="round">
                        <animateTransform attributeName="transform" type="rotate" from="360 50 50" to="0 50 50" dur="1.2s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>
            <div class="preloader-text">Preparing Excellence</div>
        </div>
    </div>

    <div id="content" style="display: none;">
        <!-- Enhanced Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container">
                <!-- Logo and School Name (Left Side) -->
                <a class="navbar-brand" href="{{ url_for('main.index') }}" data-translate="Francis Maria Libermann School">
                    <img src="{{ url_for('static', filename='assets/logo.jpeg') }}" alt="FML Logo">
                    Francis Maria <br> Libermann School
                </a>
                
                <!-- Mobile Toggle Button -->
                <button id="navbarToggler" class="navbar-toggler" type="button" aria-label="Toggle navigation">
                    <i class="material-icons" id="togglerIcon">dehaze</i>
                </button>
                
                <!-- Navigation Links (Right Side) -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'index' %}active{% endif %}" href="{{ url_for('main.index') }}" data-translate="Home">
                                <i class="fas fa-home me-1"></i> Home
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'about' %}active{% endif %}" href="{{ url_for('main.index') }}about" data-translate="About Us">
                                <i class="fas fa-info-circle me-1"></i> About Us
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'admissions' %}active{% endif %}" href="{{ url_for('main.admissions') }}" data-translate="Admissions">
                                <i class="fas fa-graduation-cap me-1"></i> Admissions
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'school-life' %}active{% endif %}" href="{{ url_for('main.school_life') }}" data-translate="School Life">
                                <i class="fas fa-school me-1"></i> School Life
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'community' %}active{% endif %}" href="{{ url_for('main.community') }}" data-translate="Community">
                                <i class="fas fa-users me-1"></i> Community
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'contact' %}active{% endif %}" href="{{ url_for('main.contact') }}" data-translate="Contact">
                                <i class="fas fa-envelope me-1"></i> Contact
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Email Sent Spinner Overlay -->
        <div class="email-sent-overlay" id="emailSentOverlay">
            <div role="status">
                <svg aria-hidden="true" class="w-16 h-16 text-gray-200 animate-spin dark:text-gray-600 fill-green-500" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
                    <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
                </svg>
                <span class="sr-only">Message Sent</span>
            </div>
        </div>

        <!-- Flash Messages Container - Bottom Position -->
        <div id="flash-messages-container" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1060; width: auto; max-width: 90%; display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <!-- Dynamic flash messages will appear here -->
        </div>

        <!-- Server-side flash messages are injected into the bottom container by client JS -->

        <!-- Page Content -->
        {% block content %}{% endblock %}

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <h4 data-translate="Francis Maria Libermann School">Francis Maria Libermann School</h4>
                        <p data-translate="Empowering students to aim higher since 1998 in Zanzibar.">
                            Empowering students to aim higher since 1998 in Zanzibar.
                        </p>
                        <div class="social-links">
                            <a href="https://www.instagram.com/fmlibermann/?hl=en" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                            <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <h4 data-translate="Contact Us">Contact Us</h4>
                        <ul class="footer-links">
                            <li><i class="fas fa-map-marker-alt me-2" aria-hidden="true"></i> <span data-translate="Shehia of Tomondo, in western district, in urban western Region.">Shehia of Tomondo, in western district, in urban western Region.</span></li>
                            <li><i class="fas fa-phone me-2" aria-hidden="true"></i> <span data-translate="+255 658 638 938, +255 713 616 049">+255 658 638 938, +255 713 616 049</span></li>
                            <li><i class="fas fa-envelope me-2" aria-hidden="true"></i> 
                                <a href="{{ url_for('main.contact') }}" data-translate="Contact Us">fmlibermann@gmail.com</a>
                            </li>
                            <li><i class="fab fa-whatsapp me-2" aria-hidden="true"></i> <a href="https://wa.me/255713616049?text=Hello,%20I%20need%20assistance%20with%20Francis%20Maria%20Libermann%20School!" target="_blank" data-translate="Chat on WhatsApp">Chat on WhatsApp</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-4">
                        <h4 data-translate="Quick Links">Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="{{ url_for('main.index') }}about" data-translate="About Us">About Us</a></li>
                            <li><a href="{{ url_for('main.admissions') }}" data-translate="Admissions Info">Admissions Info</a></li>
                            <li><a href="{{ url_for('main.school_life') }}" data-translate="School Life">School Life</a></li>
                            <li><a href="{{ url_for('main.contact') }}" data-translate="Contact Us">Contact Us</a></li>
                            <li><a href="https://matokeo.necta.go.tz/" target="_blank" data-translate="NECTA Results">NECTA Results</a></li>
                        </ul>
                    </div>
                </div>
                <div class="copyright" data-translate="¬© 2025 Francis Maria Libermann School. All rights reserved.">
                    ¬© 2025 Francis Maria Libermann School. All rights reserved.
                </div>
            </div>
        </footer>

        <!-- Enhanced AI Chatbot -->
        <div class="chatbot">
            <button class="chatbot-toggle" id="chatbotToggle" aria-label="Open Chatbot">
                <i class="fas fa-robot" aria-hidden="true"></i>
            </button>
            <div class="chatbot-box" id="chatbotBox">
                <div class="chatbot-header">
                    <div class="chatbot-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="chatbot-info">
                        <h5>FML School Assistant</h5>
                        <p>Online now</p>
                    </div>
                    <button class="chatbot-close" id="chatbotClose" aria-label="Close Chatbot">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="chatbot-body" id="chatbotMessages">
                    <div class="chat-message bot-message">
                        <p><strong>Hello! I'm your FML School Assistant ü§ñ</strong></p>
                        <p>I can help you with information about:</p>
                        <ul>
                            <li>üìö Admissions & Applications</li>
                            <li>üí∞ Fees & Payment</li>
                            <li>üè´ Programs & Curriculum</li>
                            <li>üìÖ School Calendar</li>
                            <li>üìç Location & Contacts</li>
                            <li>üéì Academic Results</li>
                            <li>üèõÔ∏è School History</li>
                            <li>‚öΩ Facilities & Activities</li>
                        </ul>
                        <p>What would you like to know about Francis Maria Libermann School?</p>
                    </div>
                </div>
                <div class="chatbot-footer">
                    <div class="input-prompt">
                        <i class="fas fa-lightbulb me-2"></i>Ask me anything about our school...
                    </div>
                    <div class="chat-input-container">
                        <div class="input-wrapper">
                            <span class="input-prefix">></span>
                            <input type="text" id="chatbotInput" placeholder="Type your question here..." aria-label="Chat message">
                        </div>
                        <button class="btn btn-primary" id="chatbotSend">
                            <i class="fas fa-paper-plane" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.1/vanilla-tilt.min.js"></script>
        <script src="{{ url_for('static', filename='translations.js') }}"></script>
        <script src="{{ url_for('static', filename='scripts.js') }}"></script>
        <script>
            // Modern toggler and dropdown close on outside click
            document.addEventListener('DOMContentLoaded', function() {
                var toggler = document.getElementById('navbarToggler');
                var nav = document.getElementById('navbarNav');
                var expanded = false;
                function closeMenu() {
                    nav.classList.remove('show');
                    toggler.setAttribute('aria-expanded', 'false');
                    expanded = false;
                }
                toggler.addEventListener('click', function(e) {
                    e.stopPropagation();
                    expanded = !expanded;
                    if (expanded) {
                        nav.classList.add('show');
                        toggler.setAttribute('aria-expanded', 'true');
                    } else {
                        closeMenu();
                    }
                });
                document.addEventListener('click', function(e) {
                    if (expanded && !nav.contains(e.target) && e.target !== toggler) {
                        closeMenu();
                    }
                });
                nav.addEventListener('click', function(e) {
                    if (e.target.classList.contains('nav-link')) {
                        closeMenu();
                    }
                });
            });

            // Inject server-side flashed messages into the unified bottom flash container
            (function() {
                // Put the JSON into a JS string to avoid template braces confusing static analysis
                const messagesJson = '{{ get_flashed_messages(with_categories=true) | tojson | safe }}';
                let messages = [];
                try {
                    messages = JSON.parse(messagesJson || '[]');
                } catch (e) {
                    console.warn('Failed to parse flashed messages JSON', e);
                    messages = [];
                }

                if (messages && messages.length) {
                    function flushMessages() {
                        if (typeof showFlashMessage === 'function') {
                            messages.forEach(function(pair) {
                                const category = pair[0] || 'info';
                                const message = pair[1] || '';
                                showFlashMessage(message, category);
                            });
                        } else {
                            setTimeout(flushMessages, 50);
                        }
                    }
                    flushMessages();
                }
            })();
        </script>
    </div>
</body>
</html>